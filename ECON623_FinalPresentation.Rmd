---
title: "Can we predict the future of the cars of the future: A study on predictors of EV car manufacturor stock returns"
subtitle: "ECON 623: Dinghai Xu"
author: "Andrew Girgis"
output: beamer_presentation
bibliography: references.bib 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, include=FALSE}
library(readr)
library(dplyr)
library(plyr)
library(tidyquant)
library(xts)
library(moments)
library(zoo)
library(ggplot2)
library(tidyr)
library(purrr)
library(stargazer)
library(kableExtra)
library(xtable)
library(Hmisc)
library(rugarch)
library(rmgarch)
library(urca)
library(vars)
library(mFilter)
library(tseries)
library(forecast)
```

```{r, include=FALSE}
Lucid_dta <- tq_get("LCID", get = "stock.prices", from = "2021-11-29", to = "2024-03-20")
Rivian_dta <- tq_get("RIVN", get = "stock.prices", from = "2021-11-29", to = "2024-03-20")
Tesla_dta <- tq_get("TSLA", get = "stock.prices", from = "2021-11-29", to = "2024-03-20")
Nio_dta <- tq_get("NIO", get = "stock.prices", from = "2021-11-29", to = "2024-03-20")
FF_dta <- tq_get("FFIE", get = "stock.prices", from = "2021-11-29", to = "2024-03-20")
Fisker_dta <- tq_get("FSRN", get = "stock.prices", from = "2021-11-29", to = "2024-03-20")
```

```{r, include=FALSE}
Crude_dta <- tq_get("CLK24.NYM", get = "stock.prices", from = "2021-11-29", to = "2024-03-20")
Gasoline_dta <- tq_get("RBK24.NYM", get = "stock.prices", from = "2021-11-29", to = "2024-03-20")
LitBat_dta <- tq_get("LIT", get = "stock.prices", from = "2021-11-29", to = "2024-03-20")
Chargepoint_dta <- tq_get("CHPT", get = "stock.prices", from = "2021-11-29", to = "2024-03-20")
Blink_dta <- tq_get("BLNK", get = "stock.prices", from = "2021-11-29", to = "2024-03-20")
```

```{r, include=FALSE}
Crude_dta <- subset(Crude_dta, (date %in% Lucid_dta$date))
Gasoline_dta <- subset(Gasoline_dta, (date %in% Lucid_dta$date))
```


```{r, include=FALSE}
#Lucid_dta = read.csv('/Users/andrew/Downloads/UW courses/ECON 623/Presentation/LCID.csv')
#Rivian_dta = read.csv('/Users/andrew/Downloads/UW courses/ECON 623/Presentation/RIVN.csv')
#Tesla_dta = read.csv('/Users/andrew/Downloads/UW courses/ECON 623/Presentation/TSLA.csv')
#Nio_dta = read.csv('/Users/andrew/Downloads/UW courses/ECON 623/Presentation/NIO.csv')
#FF_dta = read.csv('/Users/andrew/Downloads/UW courses/ECON 623/Presentation/FFIE.csv')
#Fisker_dta = read.csv('/Users/andrew/Downloads/UW courses/ECON 623/Presentation/FSRN.csv')
```

```{r, include=FALSE}

# Define colors
Lucid_col <- 'black'
Fisker_col <- 'dodgerblue2'
Rivian_col <- 'forestgreen'
FF_col <- 'orange'
Nio_col <- 'darkorchid2'
Tesla_col <- 'red2'

# Create a data frame for plotting
plot_data <- data.frame(
  Year = Lucid_dta$date,
  Lucid = log(Lucid_dta$adjusted),
  Fisker = log(Fisker_dta$adjusted),
  Rivian = log(Rivian_dta$adjusted),
  FF = log(FF_dta$adjusted),
  Nio = log(Nio_dta$adjusted),
  Tesla = log(Tesla_dta$adjusted)
)

# Plot using ggplot2
all_log_adj_plot <- ggplot(plot_data, aes(x = Year)) +
  geom_line(aes(y = Lucid, color = "Lucid"), size = 0.5) +
  geom_line(aes(y = Fisker, color = "Fisker"), size = 0.5) +
  geom_line(aes(y = Rivian, color = "Rivian"), size = 0.5) +
  geom_line(aes(y = FF, color = "FF"), size = 0.5) +
  geom_line(aes(y = Nio, color = "Nio"), size = 0.5) +
  geom_line(aes(y = Tesla, color = "Tesla"), size = 0.5) +
  scale_color_manual(name = "Companies",
                     values = c(Lucid = Lucid_col, Fisker = Fisker_col, Rivian = Rivian_col,
                                FF = FF_col, Nio = Nio_col, Tesla = Tesla_col)) +
  labs(title = "Logged Adjusted Close of Independants on Year", x = "Year", y = "Log Adj Close") +
  theme_minimal()

all_log_adj_plot
```

```{r, include=FALSE}
# Define colors
Crude_col <- 'black'
Gasoline_col <- 'darkorange'
LitBat_col <- 'dodgerblue2'
Chargepoint_col <- 'forestgreen'
Blink_col <- 'red2'


# Create a data frame for plotting
plot_data_dep <- data.frame(
  Year = Crude_dta$date,  # Check if Crude_dta$date contains valid dates
  Crude = log(Crude_dta$adjusted),  # Check if Crude_dta$adjusted contains valid numeric data
  Gasoline = log(Gasoline_dta$adjusted),
  LitBat = log(LitBat_dta$adjusted),
  Chargepoint = log(Chargepoint_dta$adjusted),
  Blink = log(Blink_dta$adjusted)
)

# Plot using ggplot2
all_log_adj_plot_dep <- ggplot(plot_data_dep, aes(x = Year)) +
  geom_line(aes(y = Crude, color = "Crude"), size = 0.5) +
  geom_line(aes(y = Gasoline, color = "Gasoline"), size = 0.5) +
  geom_line(aes(y = LitBat, color = "LitBat"), size = 0.5) +
  geom_line(aes(y = Chargepoint, color = "Chargepoint"), size = 0.5) +
  geom_line(aes(y = Blink, color = "Blink"), size = 0.5) +
  scale_color_manual(name = "Companies",
                     values = c(Crude = Crude_col, Gasoline = Gasoline_col, LitBat = LitBat_col,
                                Chargepoint = Chargepoint_col, Blink = Blink_col)) +
  labs(title = "Logged Adjusted Close of Dependants on Year", x = "Year", y = "Log Adj Close")

# Print the plot
print(all_log_adj_plot_dep)
```


```{r, include=FALSE}
data_cleaning <- function(df) {
  df <- df[, -c(1, 3:6)]
  df <- mutate(df, adjusted_lag = lag(adjusted))
  df <- mutate(df, returns = 100 * (log(adjusted) - log(adjusted_lag)))
  df <- mutate(df, returns_2 = (returns)^2)
  df <- na.omit(df) 
  return(df)
}
```


```{r, include=FALSE}
FF_dta <- data_cleaning(FF_dta)
Fisker_dta <- data_cleaning(Fisker_dta)
Lucid_dta <- data_cleaning(Lucid_dta)
Nio_dta <- data_cleaning(Nio_dta)
Rivian_dta <- data_cleaning(Rivian_dta)
Tesla_dta <- data_cleaning(Tesla_dta)

Crude_dta <- data_cleaning(Crude_dta)
Gasoline_dta <- data_cleaning(Gasoline_dta)
LitBat_dta <- data_cleaning(LitBat_dta)
Chargepoint_dta <- data_cleaning(Chargepoint_dta)
Blink_dta <- data_cleaning(Blink_dta)
```


```{r, include=FALSE}
# FF histogram
FF_histogram <- ggplot(FF_dta, aes(x = returns)) +
  geom_histogram(binwidth = 1, fill = FF_col, color = "white") +
  labs(title = "Histogram of FF Returns", x = "Returns", y = "Frequency") +
  theme_minimal()
FF_histogram

# Summary statistics for FF
FF_summary_stats <- FF_dta %>%
  summarise(mean = mean(returns),
            variance = var(returns),
            skewness = skewness(returns),
            kurtosis = kurtosis(returns))
FF_summary_stats

# ACF plot for FF
FF_acf <- acf(FF_dta$returns, lag.max = 20, main = "ACF for FF")
FF_acf_plot <- plot(FF_acf, main = "ACF for FF")
FF_acf_plot


```

```{r, include=FALSE}
# Tesla histogram
Tesla_histogram <- ggplot(Tesla_dta, aes(x = returns)) +
  geom_histogram(binwidth = 1, fill = Tesla_col, color = "white") +
  labs(title = "Histogram of Tesla Returns", x = "Returns", y = "Frequency") +
  theme_minimal()
Tesla_histogram

# Summary statistics for Tesla
Tesla_summary_stats <- Tesla_dta %>%
  summarise(mean = mean(returns),
            variance = var(returns),
            skewness = skewness(returns),
            kurtosis = kurtosis(returns))
Tesla_summary_stats

# ACF plot for Tesla
Tesla_acf <- acf(Tesla_dta$returns, lag.max = 20, main = "ACF for Tesla")
Tesla_acf_plot <- plot(Tesla_acf, main = "ACF for Tesla")
Tesla_acf_plot

```

```{r, include=FALSE}
# Lucid histogram
Lucid_histogram <- ggplot(Lucid_dta, aes(x = returns)) +
  geom_histogram(binwidth = 1, fill = Lucid_col, color = "white") +
  labs(title = "Histogram of Lucid Returns", x = "Returns", y = "Frequency") +
  theme_minimal()
Lucid_histogram

# Summary statistics for Lucid
Lucid_summary_stats <- Lucid_dta %>%
  summarise(mean = mean(returns),
            variance = var(returns),
            skewness = skewness(returns),
            kurtosis = kurtosis(returns))
Lucid_summary_stats

# ACF plot for Lucid
Lucid_acf <- acf(Lucid_dta$returns, lag.max = 20, main = "ACF for Lucid")
Lucid_acf_plot <- plot(Lucid_acf, main = "ACF for Lucid")
Lucid_acf_plot

```

```{r, include=FALSE}
# Rivian histogram
Rivian_histogram <- ggplot(Rivian_dta, aes(x = returns)) +
  geom_histogram(binwidth = 1, fill = Rivian_col, color = "white") +
  labs(title = "Histogram of Rivian Returns", x = "Returns", y = "Frequency") +
  theme_minimal()
Rivian_histogram


# Summary statistics for Rivian
Rivian_summary_stats <- Rivian_dta %>%
  summarise(mean = mean(returns),
            variance = var(returns),
            skewness = skewness(returns),
            kurtosis = kurtosis(returns))
Rivian_summary_stats

# ACF plot for Rivian
Rivian_acf <- acf(Rivian_dta$returns, lag.max = 20, main = "ACF for Rivian")
Rivian_acf_plot <- plot(Rivian_acf, main = "ACF for Rivian")
Rivian_acf_plot

```

```{r, include=FALSE}
# Fisker histogram
Fisker_histogram <- ggplot(Fisker_dta, aes(x = returns)) +
  geom_histogram(binwidth = 1, fill = Fisker_col, color = "white") +
  labs(title = "Histogram of Fisker Returns", x = "Returns", y = "Frequency") +
  theme_minimal()
Fisker_histogram

# Summary statistics for Fisker
Fisker_summary_stats <- Fisker_dta %>%
  summarise(mean = mean(returns),
            variance = var(returns),
            skewness = skewness(returns),
            kurtosis = kurtosis(returns))
Fisker_summary_stats

# ACF plot for Fisker
Fisker_acf <- acf(Fisker_dta$returns, lag.max = 20, main = "ACF for Fisker")
Fisker_acf_plot <- plot(Fisker_acf, main = "ACF for Fisker")
Fisker_acf_plot

```

```{r, include=FALSE}
# Nio histogram
Nio_histogram <- ggplot(Nio_dta, aes(x = returns)) +
  geom_histogram(binwidth = 1, fill = Nio_col, color = "white") +
  labs(title = "Histogram of Nio Returns", x = "Returns", y = "Frequency") +
  theme_minimal()
Nio_histogram

# Summary statistics for Nio
Nio_summary_stats <- Nio_dta %>%
  summarise(mean = mean(returns),
            variance = var(returns),
            skewness = skewness(returns),
            kurtosis = kurtosis(returns))
Nio_summary_stats

# ACF plot for Nio
Nio_acf <- acf(Nio_dta$returns, lag.max = 20, main = "ACF for Nio")
Nio_acf_plot <- plot(Nio_acf, main = "ACF for Nio")
Nio_acf_plot

```

```{r, include=FALSE}
# Crude histogram
Crude_histogram <- ggplot(Crude_dta, aes(x = returns)) +
  geom_histogram(binwidth = 1, fill = Crude_col, color = "white") +
  labs(title = "Histogram of Crude Returns", x = "Returns", y = "Frequency") +
  theme_minimal()
Crude_histogram

# Summary statistics for Crude
Crude_summary_stats <- Crude_dta %>%
  summarise(mean = mean(returns),
            variance = var(returns),
            skewness = skewness(returns),
            kurtosis = kurtosis(returns))
Crude_summary_stats

# ACF plot for Crude
Crude_acf <- acf(Crude_dta$returns, lag.max = 20, main = "ACF for Crude")
Crude_acf_plot <- plot(Crude_acf, main = "ACF for Crude")
Crude_acf_plot

```

```{r, include=FALSE}
# Gasoline histogram
Gasoline_histogram <- ggplot(Gasoline_dta, aes(x = returns)) +
  geom_histogram(binwidth = 1, fill = Gasoline_col, color = "white") +
  labs(title = "Histogram of Gasoline Returns", x = "Returns", y = "Frequency") +
  theme_minimal()
Gasoline_histogram

# Summary statistics for Gasoline
Gasoline_summary_stats <- Gasoline_dta %>%
  summarise(mean = mean(returns),
            variance = var(returns),
            skewness = skewness(returns),
            kurtosis = kurtosis(returns))
Gasoline_summary_stats

# ACF plot for Gasoline
Gasoline_acf <- acf(Gasoline_dta$returns, lag.max = 20, main = "ACF for Gasoline")
Gasoline_acf_plot <- plot(Gasoline_acf, main = "ACF for Gasoline")
Gasoline_acf_plot

```

```{r, include=FALSE}
# LitBat histogram
LitBat_histogram <- ggplot(LitBat_dta, aes(x = returns)) +
  geom_histogram(binwidth = 1, fill = LitBat_col, color = "white") +
  labs(title = "Histogram of LitBat Returns", x = "Returns", y = "Frequency") +
  theme_minimal()
LitBat_histogram

# Summary statistics for LitBat
LitBat_summary_stats <- LitBat_dta %>%
  summarise(mean = mean(returns),
            variance = var(returns),
            skewness = skewness(returns),
            kurtosis = kurtosis(returns))
LitBat_summary_stats

# ACF plot for LitBat
LitBat_acf <- acf(LitBat_dta$returns, lag.max = 20, main = "ACF for LitBat")
LitBat_acf_plot <- plot(LitBat_acf, main = "ACF for LitBat")
LitBat_acf_plot

```


```{r, include=FALSE}
# Chargepoint histogram
Chargepoint_histogram <- ggplot(Chargepoint_dta, aes(x = returns)) +
  geom_histogram(binwidth = 1, fill = Chargepoint_col, color = "white") +
  labs(title = "Histogram of Chargepoint Returns", x = "Returns", y = "Frequency") +
  theme_minimal()
Chargepoint_histogram

# Summary statistics for Chargepoint
Chargepoint_summary_stats <- Chargepoint_dta %>%
  summarise(mean = mean(returns),
            variance = var(returns),
            skewness = skewness(returns),
            kurtosis = kurtosis(returns))
Chargepoint_summary_stats

# ACF plot for Chargepoint
Chargepoint_acf <- acf(Chargepoint_dta$returns, lag.max = 20, main = "ACF for Chargepoint")
Chargepoint_acf_plot <- plot(Chargepoint_acf, main = "ACF for Chargepoint")
Chargepoint_acf_plot

```

```{r, include=FALSE}
# Blink histogram
Blink_histogram <- ggplot(Blink_dta, aes(x = returns)) +
  geom_histogram(binwidth = 1, fill = Blink_col, color = "white") +
  labs(title = "Histogram of Blink Returns", x = "Returns", y = "Frequency") +
  theme_minimal()
Blink_histogram

# Summary statistics for Blink
Blink_summary_stats <- Blink_dta %>%
  summarise(mean = mean(returns),
            variance = var(returns),
            skewness = skewness(returns),
            kurtosis = kurtosis(returns))
Blink_summary_stats

# ACF plot for Blink
Blink_acf <- acf(Blink_dta$returns, lag.max = 20, main = "ACF for Blink")
Blink_acf_plot <- plot(Blink_acf, main = "ACF for Blink")
Blink_acf_plot

```


```{r, include=FALSE}

summary_stats_all <- bind_rows(
  FF_summary_stats %>% mutate(Company = "FF"),
  Fisker_summary_stats %>% mutate(Company = "Fisker"),
  Lucid_summary_stats %>% mutate(Company = "Lucid"),
  Nio_summary_stats %>% mutate(Company = "Nio"),
  Rivian_summary_stats %>% mutate(Company = "Rivian"),
  Tesla_summary_stats %>% mutate(Company = "Tesla")
)

summary_stats_all <- summary_stats_all[, c(5, 1:4)]

summary_stats_all <- as.data.frame(t(summary_stats_all))
names(summary_stats_all) <- summary_stats_all[1,]
summary_stats_all <- summary_stats_all[-1,]

print(summary_stats_all)

summary_stats_all[, -1] <- lapply(summary_stats_all[, -1], as.character)

summary_stats_xtable_obj <- xtable(summary_stats_all)

print(summary_stats_xtable_obj, include.rownames = TRUE)

```

```{r, include=FALSE}

# Create a data frame containing all return column data from multiple data frames
all_returns_dep <- cbind(
  Crude_dta["returns"],
  Gasoline_dta["returns"],
  LitBat_dta["returns"],
  Chargepoint_dta["returns"],
  Blink_dta["returns"]
)

# Rename the columns with the corresponding company names
colnames(all_returns_dep) <- c("Crude", "Gasoline", "LitBat", "Chargepoint", "Blink")

# Print the resulting data frame
print(all_returns_dep)

# Compute correlation matrix
returns_cor_dep <- cor(all_returns_dep)

# Set upper triangular elements to NA
returns_cor_dep[upper.tri(returns_cor_dep)] <- NA

# Print the correlation matrix
print(returns_cor_dep)

# Create xtable object
returns_cor_dep_xtable <- xtable(returns_cor_dep)

# Print the LaTeX table
print(returns_cor_dep_xtable, include.rownames = TRUE)

```


```{r, include=FALSE}

summary_stats_all_dep <- bind_rows(
  Crude_summary_stats %>% mutate(Company = "Crude"),
  Gasoline_summary_stats %>% mutate(Company = "Gasoline"),
  LitBat_summary_stats %>% mutate(Company = "LitBat"),
  Chargepoint_summary_stats %>% mutate(Company = "Chargepoint"),
  Blink_summary_stats %>% mutate(Company = "Blink")
)

summary_stats_all_dep <- summary_stats_all_dep[, c(5, 1:4)]

summary_stats_all_dep <- as.data.frame(t(summary_stats_all_dep))
names(summary_stats_all_dep) <- summary_stats_all_dep[1,]
summary_stats_all_dep <- summary_stats_all_dep[-1,]

print(summary_stats_all_dep)

summary_stats_all_dep[, -1] <- lapply(summary_stats_all_dep[, -1], as.character)

summary_stats_dep_xtable_obj <- xtable(summary_stats_all_dep)

print(summary_stats_dep_xtable_obj, include.rownames = TRUE)

```

```{r, include=FALSE}

# Create a data frame containing all return column data from multiple data frames
all_returns <- cbind(
  Crude_dta["returns"],
  Gasoline_dta["returns"],
  LitBat_dta["returns"],
  Chargepoint_dta["returns"],
  Blink_dta["returns"]
)

# Rename the columns with the corresponding company names
colnames(all_returns) <- c("Crude", "Gasoline", "LitBat", "Chargepoint", "Blink")

# Print the resulting data frame
print(all_returns)

# Compute correlation matrix
returns_cor <- cor(all_returns)

# Set upper triangular elements to NA
returns_cor[upper.tri(returns_cor)] <- NA

# Print the correlation matrix
print(returns_cor)

# Create xtable object
returns_cor_xtable <- xtable(returns_cor)

# Print the LaTeX table
print(returns_cor_xtable, include.rownames = TRUE)

```

```{r, include=FALSE}
## RIVIAN OLS

Rivian_olsmodel = lm(Rivian_dta$returns ~ lag(Crude_dta$returns) + lag(Gasoline_dta$returns) + lag(LitBat_dta$returns) + lag(Chargepoint_dta$returns) + lag(Blink_dta$returns))
summary(Rivian_olsmodel)

Rivian_olsmodel2 = lm(Rivian_dta$returns ~ lag(Gasoline_dta$returns) + lag(LitBat_dta$returns) + lag(Chargepoint_dta$returns))
summary(Rivian_olsmodel2)
```
 

```{r, include=FALSE}
## RIVIAN VAR SETUP

#Finding optimal lags

opt_lags_Rivian <- cbind(Rivian_dta$returns, Gasoline_dta$returns, LitBat_dta$returns, Chargepoint_dta$returns)
colnames(opt_lags_Rivian) <- cbind("Rivian", "Gas", "Lithium_batteries", "Chargepoint")

lagselect_rivian <- VARselect(opt_lags_Rivian, lag.max = 10, type = 'const')
lagselect_rivian
#according to all indicators we should use 1 lag

VAR_model_Rivian <- VAR(opt_lags_Rivian, p = 1, type = "const", season = NULL, exog = NULL)
summary(VAR_model_Rivian)

# Granger Causality

Granger_Rivian <- causality(VAR_model_Rivian, cause = "Rivian")
Granger_Rivian

Granger_Gas <- causality(VAR_model_Rivian, cause = "Gas")
Granger_Gas

Granger_LitBat <- causality(VAR_model_Rivian, cause = "Lithium_batteries")
Granger_LitBat

Granger_Chargepoint <- causality(VAR_model_Rivian, cause = "Chargepoint")
Granger_Chargepoint


# Impulse repsonse

IR_Rivian_Gas <- irf(VAR_model_Rivian, impulse = "Gas", response = "Rivian", n.ahead = 20)
plot(IR_Rivian_Gas)

IR_Rivian_Lit <- irf(VAR_model_Rivian, impulse = "Lithium_batteries", response = "Rivian", n.ahead = 20)
plot(IR_Rivian_Lit)

IR_Rivian_CP <- irf(VAR_model_Rivian, impulse = "Chargepoint", response = "Rivian", n.ahead = 20)
plot(IR_Rivian_CP)

IR_Gas_Rivian <- irf(VAR_model_Rivian, impulse = "Rivian", response = "Gas", n.ahead = 20)
plot(IR_Gas_Rivian)

IR_Lit_Rivian <- irf(VAR_model_Rivian, impulse = "Rivian", response = "Lithium_batteries", n.ahead = 20)
plot(IR_Lit_Rivian)

IR_CP_Rivian <- irf(VAR_model_Rivian, impulse = "Rivian", response = "Chargepoint", n.ahead = 20)
plot(IR_CP_Rivian)

# Forecast

Rivian_forcast <- predict(VAR_model_Rivian, n.ahead = 6, ci = 0.95)
plot(Rivian_forcast, names = 'Rivian', plot.conf = TRUE, xlim = c(500, 610), main = "Forcast of Rivian returns", ylab = "Rivian returns", xlab = "Days since IPO")

```


```{r, include=FALSE}
## TESLA SETUP

#Finding optimal lags

opt_lags_Tesla <- cbind(Tesla_dta$returns, Gasoline_dta$returns, LitBat_dta$returns, Chargepoint_dta$returns)
colnames(opt_lags_Tesla) <- cbind("Tesla", "Gas", "Lithium_batteries", "Chargepoint")

lagselect_Tesla <- VARselect(opt_lags_Tesla, lag.max = 10, type = 'const')
lagselect_Tesla
#according to all indicators we should use 1 lag

VAR_model_Tesla <- VAR(opt_lags_Tesla, p = 1, type = "const", season = NULL, exog = NULL)
summary(VAR_model_Tesla)

# Granger Causality

Granger_Tesla <- causality(VAR_model_Tesla, cause = "Tesla")
Granger_Tesla

Granger_Gas <- causality(VAR_model_Tesla, cause = "Gas")
Granger_Gas

Granger_LitBat <- causality(VAR_model_Tesla, cause = "Lithium_batteries")
Granger_LitBat

Granger_Chargepoint <- causality(VAR_model_Tesla, cause = "Chargepoint")
Granger_Chargepoint


# Impulse response

IR_Tesla_Gas <- irf(VAR_model_Tesla, impulse = "Gas", response = "Tesla", n.ahead = 20)
plot(IR_Tesla_Gas)

IR_Tesla_Lit <- irf(VAR_model_Tesla, impulse = "Lithium_batteries", response = "Tesla", n.ahead = 20)
plot(IR_Tesla_Lit)

IR_Tesla_CP <- irf(VAR_model_Tesla, impulse = "Chargepoint", response = "Tesla", n.ahead = 20)
plot(IR_Tesla_CP)

IR_Gas_Tesla <- irf(VAR_model_Tesla, impulse = "Tesla", response = "Gas", n.ahead = 20)
plot(IR_Gas_Tesla)

IR_Lit_Tesla <- irf(VAR_model_Tesla, impulse = "Tesla", response = "Lithium_batteries", n.ahead = 20)
plot(IR_Lit_Tesla)

IR_CP_Tesla <- irf(VAR_model_Tesla, impulse = "Tesla", response = "Chargepoint", n.ahead = 20)
plot(IR_CP_Tesla)

# Forecast

Tesla_forecast <- predict(VAR_model_Tesla, n.ahead = 6, ci = 0.95)
plot(Tesla_forecast, names = 'Tesla', plot.conf = TRUE, xlim = c(540, 620), main = "Forecast of Tesla returns", ylab = "Tesla returns", xlab = "Days since first observation")


```



```{r, include=FALSE}
## GARCH

Gas_matrix <- as.matrix(Gasoline_dta$returns)
LitBat_matrix <- as.matrix(LitBat_dta$returns)
Chargepoint_matrix <- as.matrix(Chargepoint_dta$returns)

mod_spec_garch <- ugarchspec(
  mean.model = list(armaOrder = c(0, 0)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(1, 1))
)

mod_fitting_garch <- ugarchfit(data = Rivian_dta$returns, spec = mod_spec_garch, out.sample = 20)

mod_fitting_garch

plot(mod_fitting_garch, which = 'all')

```

```{r, include=FALSE}
# Define different specifications
mod_spec_garch2 <- ugarchspec(
  mean.model = list(armaOrder = c(1, 0)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(1, 1))
)

mod_spec_garch3 <- ugarchspec(
  mean.model = list(armaOrder = c(0, 1)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(1, 1))
)

mod_spec_garch4 <- ugarchspec(
  mean.model = list(armaOrder = c(1, 1)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(1, 1))
)

mod_spec_garch5 <- ugarchspec(
  mean.model = list(armaOrder = c(0, 0)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(2, 1))
)

mod_spec_garch6 <- ugarchspec(
  mean.model = list(armaOrder = c(1, 0)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(2, 1))
)

mod_spec_garch7 <- ugarchspec(
  mean.model = list(armaOrder = c(0, 1)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(2, 1))
)

mod_spec_garch8 <- ugarchspec(
  mean.model = list(armaOrder = c(1, 1)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(2, 1))
)

mod_spec_garch9 <- ugarchspec(
  mean.model = list(armaOrder = c(0, 0)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(2, 2))
)




# Fit and plot each model
mod_fitting_garch2 <- ugarchfit(data = Rivian_dta$returns, spec = mod_spec_garch2, out.sample = 20)
mod_fitting_garch2
plot(mod_fitting_garch2, which = 'all')

mod_fitting_garch3 <- ugarchfit(data = Rivian_dta$returns, spec = mod_spec_garch3, out.sample = 20)
mod_fitting_garch3
plot(mod_fitting_garch3, which = 'all')

mod_fitting_garch4 <- ugarchfit(data = Rivian_dta$returns, spec = mod_spec_garch4, out.sample = 20)
mod_fitting_garch4
plot(mod_fitting_garch4, which = 'all')

mod_fitting_garch5 <- ugarchfit(data = Rivian_dta$returns, spec = mod_spec_garch5, out.sample = 20)
mod_fitting_garch5
plot(mod_fitting_garch5, which = 'all')

mod_fitting_garch6 <- ugarchfit(data = Rivian_dta$returns, spec = mod_spec_garch6, out.sample = 20)
mod_fitting_garch6
plot(mod_fitting_garch6, which = 'all')

mod_fitting_garch7 <- ugarchfit(data = Rivian_dta$returns, spec = mod_spec_garch7, out.sample = 20)
mod_fitting_garch7
plot(mod_fitting_garch7, which = 'all')

mod_fitting_garch8 <- ugarchfit(data = Rivian_dta$returns, spec = mod_spec_garch8, out.sample = 20)
mod_fitting_garch8
plot(mod_fitting_garch8, which = 'all')

mod_fitting_garch9 <- ugarchfit(data = Rivian_dta$returns, spec = mod_spec_garch9, out.sample = 20)
mod_fitting_garch9
plot(mod_fitting_garch9, which = 'all')


```

```{r, include=FALSE}
## GARCH

mod_spec_garch <- ugarchspec(
  mean.model = list(armaOrder = c(0, 0)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(1, 1))
)

mod_fitting_garch <- ugarchfit(data = Tesla_dta$returns, spec = mod_spec_garch, out.sample = 20)

mod_fitting_garch

plot(mod_fitting_garch, which = 'all')

# Define different specifications
mod_spec_garch2 <- ugarchspec(
  mean.model = list(armaOrder = c(1, 0)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(1, 1))
)

mod_spec_garch3 <- ugarchspec(
  mean.model = list(armaOrder = c(0, 1)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(1, 1))
)

mod_spec_garch4 <- ugarchspec(
  mean.model = list(armaOrder = c(1, 1)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(1, 1))
)

mod_spec_garch5 <- ugarchspec(
  mean.model = list(armaOrder = c(0, 0)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(2, 1))
)

mod_spec_garch6 <- ugarchspec(
  mean.model = list(armaOrder = c(1, 0)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(2, 1))
)

mod_spec_garch7 <- ugarchspec(
  mean.model = list(armaOrder = c(0, 1)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(2, 1))
)

mod_spec_garch8 <- ugarchspec(
  mean.model = list(armaOrder = c(1, 1)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(2, 1))
)

mod_spec_garch9 <- ugarchspec(
  mean.model = list(armaOrder = c(0, 0)),
  variance.model = list(model = "sGARCH", external.regressors = LitBat_matrix, garchOrder = c(2, 2))
)

# Fit and plot each model
mod_fitting_garch2 <- ugarchfit(data = Tesla_dta$returns, spec = mod_spec_garch2, out.sample = 20)
mod_fitting_garch2
plot(mod_fitting_garch2, which = 'all')

mod_fitting_garch3 <- ugarchfit(data = Tesla_dta$returns, spec = mod_spec_garch3, out.sample = 20)
mod_fitting_garch3
plot(mod_fitting_garch3, which = 'all')

mod_fitting_garch4 <- ugarchfit(data = Tesla_dta$returns, spec = mod_spec_garch4, out.sample = 20)
mod_fitting_garch4
plot(mod_fitting_garch4, which = 'all')

mod_fitting_garch5 <- ugarchfit(data = Tesla_dta$returns, spec = mod_spec_garch5, out.sample = 20)
mod_fitting_garch5
plot(mod_fitting_garch5, which = 'all')

mod_fitting_garch6 <- ugarchfit(data = Tesla_dta$returns, spec = mod_spec_garch6, out.sample = 20)
mod_fitting_garch6
plot(mod_fitting_garch6, which = 'all')

mod_fitting_garch7 <- ugarchfit(data = Tesla_dta$returns, spec = mod_spec_garch7, out.sample = 20)
mod_fitting_garch7
plot(mod_fitting_garch7, which = 'all')

mod_fitting_garch8 <- ugarchfit(data = Tesla_dta$returns, spec = mod_spec_garch8, out.sample = 20)
mod_fitting_garch8
plot(mod_fitting_garch8, which = 'all')

mod_fitting_garch9 <- ugarchfit(data = Tesla_dta$returns, spec = mod_spec_garch9, out.sample = 20)
mod_fitting_garch9
plot(mod_fitting_garch, which = 'all')

```




```{r, include=FALSE}
## TGARCH

mod_spec_tgarch <- ugarchspec(mean.model = list(armaOrder=c(1,1), variance.model = list(model = "TGARCH", garchOrder = c(1,1), distribution.model = 'sstd')))

mod_fitting_tgarch <- ugarchfit(data = Rivian_dta$returns, spec = mod_spec_tgarch, out.sample = 20)

mod_fitting_tgarch

plot(mod_fitting_tgarch, which = 'all')
```




## Introduction: **Motivation** - Literature review

- Passion for financial markets, automotives and the future of EV's(Electric Vehicles)
- New territory: EV's are making a large impact in the market currently with many bills being passed banning production of combustion engines in certain years, forcing many large automotive companies to adopt the BEV(Battery Electric Vehicles) model.
- Can the returns of these new EV startups be predicted using complementary and substitutionary commodities and goods?

## Introduction: Motivation - **Literature review**

- Shen, J., Griffith, J., Najand, M., & Sun, L. (2021). Predicting stock and bond market returns with emotions: Evidence from futures markets. Journal of Behavioral Finance, 24(3), 333–344. https://doi.org/10.1080/15427560.2021.1975717  [@Shen_Griffith_Najand_Sun_2021]

- Li, T., & Sun, X. (2023). Predicting stock market returns using aggregate credit risk. International Review of Economics &amp; Finance, 88, 1087–1103. https://doi.org/10.1016/j.iref.2023.07.039 [@Li_Sun_2023]

## Introduction: Motivation - **Literature review**

- Cai, Y., & Stander, J. (2019). The threshold GARCH model: Estimation and density forecasting for financial returns*. Journal of Financial Econometrics, 18(2), 395–424. https://doi.org/10.1093/jjfinec/nbz014 [@Cai_Stander_2019]

- Hansen, P. R., & Lunde, A. (2001). A forecast comparison of volatility models: Does anything beat a GARCH(1,1)? SSRN Electronic Journal. https://doi.org/10.2139/ssrn.264571 [@Hansen_Lunde_2001]

## **Data** - Theory - Model 

```{r, echo=FALSE, fig.width=6, fig.height=3, fig.cap="Line plot of the Log Adjusted Close prices of the EV stocks we will be predicting"}
all_log_adj_plot
```

## **Data** - Theory - Model 

```{r, echo=FALSE, fig.width=6, fig.height=3, fig.cap="Line plot of the Log Adjusted Close prices of the Dependants we will be using as predictors"}
all_log_adj_plot_dep
```

## **Data** - Theory - Model


```{r, message = FALSE, echo=FALSE, fig.width=6, fig.height=4.5, fig.cap="Multipanel plot of the histograms of the EV startups", warning=FALSE}
multi_panel_plot <- gridExtra::grid.arrange(
  Lucid_histogram, Tesla_histogram, Rivian_histogram, Nio_histogram,
  nrow = 2, ncol = 3
)

print(multi_panel_plot)
```
## **Data** - Theory - Model

```{r, echo=FALSE, fig.width=6, fig.height=3, fig.cap="Histogram of Faraday Future returns"}
FF_histogram
```

## **Data** - Theory - Model

```{r, echo=FALSE, fig.width=6, fig.height=3, fig.cap="Histogram of Fisker returns"}
Fisker_histogram
```

## **Data** - Theory - Model

```{r, message = FALSE, echo=FALSE, fig.width=6, fig.height=4.5, fig.cap="Multipanel plot of the histograms of the commodities and goods", warning = FALSE}
multi_panel_plot_dep <- gridExtra::grid.arrange(
  Crude_histogram, Gasoline_histogram, LitBat_histogram,
  Chargepoint_histogram, Blink_histogram,
  nrow = 2, ncol = 3
)

multi_panel_plot_dep
```


## **Data** - Theory - Model 

\begin{table}[ht]
\centering
\begin{tabular}{rllllll}
  \hline
 Panel A & FF & Fisker & Lucid & Nio & Rivian & Tesla \\ 
  \hline
mean & -1.65 & -1.17 & -0.51 & -0.37 & -0.41 & -0.14 \\ 
  variance & 115.87 &  65.16 &  26.16 &  24.63 &  27.34 &  14.14 \\ 
  skewness &  0.30 & -5.83 &  0.51 &  0.37 & -0.45 & -0.24 \\ 
  kurtosis &  7.47 & 71.99 &  8.47 &  4.86 &  6.45 &  3.97 \\ 
  \hline
  \hline
 Panel B & FF & Fisker & Lucid & Nio & Rivian & Tesla \\ 
  \hline
FF & 1.00 &  &  &  &  &  \\ 
  Fisker & 0.21 & 1.00 &  &  &  &  \\ 
  Lucid & 0.25 & 0.38 & 1.00 &  &  &  \\ 
  Nio & 0.26 & 0.30 & 0.54 & 1.00 &  &  \\ 
  Rivian & 0.16 & 0.35 & 0.67 & 0.56 & 1.00 &  \\ 
  Tesla & 0.21 & 0.27 & 0.56 & 0.52 & 0.56 & 1.00 \\ 
   \hline
\end{tabular}
\caption{Descriptive statistics \& correlations of returns of EV stocks}
\end{table}

## **Data** - Theory - Model 

\begin{table}[ht]
\centering
\begin{tabular}{rlllll}
  \hline
Panel A & Crude & Gasoline & LitBat & Chargepoint & Blink \\ 
  \hline
mean &  0.05 &  0.05 & -0.12 & -0.45 & -0.44 \\ 
  variance &  3.05 &  2.93 &  3.83 & 28.82 & 25.90 \\ 
  skewness & -0.42 & -0.48 &  0.094 & -0.60 &  0.63 \\ 
  kurtosis &  3.67 &  4.20 &  3.28 & 10.21 &  5.37 \\ 
   \hline
  \hline
 Panel B & Crude & Gasoline & LitBat & Chargepoint & Blink \\ 
  \hline
Crude & 1.00 &  &  &  &  \\ 
  Gasoline & 0.94 & 1.00 &  &  &  \\ 
  LitBat & 0.17 & 0.19 & 1.00 &  &  \\ 
  Chargepoint & 0.01 & 0.03 & 0.49 & 1.00 &  \\ 
  Blink & 0.04 & 0.04 & 0.50 & 0.67 & 1.00 \\ 
   \hline
\end{tabular}
\caption{Descriptive statistics \& correlations of returns of Dependants}
\end{table}

## Data - **Theory** - Model 

- GARCH(1,1)

Mean Equation:

$$r_t = \mu + \epsilon_t$$
Where: \newline
- $r_t$ is the observed return at time t. \newline
- $\mu$ is the intercept term or the conditional mean of the return. \newline
- $\epsilon_t$ is the error term, assumed to be normally distributed with mean 0. \newline

## Data - **Theory** - Model 

Variance Equation (GARCH(1,1) with External Regressor):

$$\sigma^2_t = \omega + \alpha_1\epsilon^2_{t-1} \beta_1\sigma^2_{t-1} + \gamma X_{t-1} $$
Where: \newline
- $\sigma^2_{t-1}$ is the conditional variance of the return at time $t$. \newline
- $\omega$ is the intercept term. \newline
- $\alpha_1$ is the parameter associated with the lagged squared error term, representing the ARCH effect. \newline
- $\beta_1$ is the parameter associated with the lagged conditional variance, representing the GARCH effect. \newline
- $X_{t-1}$ is the external regressor, representing the lagged returns of the Lithium Battery stock returns. \newline
- $\gamma$ is the parameter associated with the external regressor. \newline


## Data - **Theory** - Model 

- VAR(1)

\[
\begin{aligned}
\begin{bmatrix}
Y_{1,t} \\
Y_{2,t} \\
\vdots \\
Y_{n,t}
\end{bmatrix} &=
\begin{bmatrix}
A_{11} & A_{12} & \dots & A_{1n} \\
A_{21} & A_{22} & \dots & A_{2n} \\
\vdots & \vdots & \ddots & \vdots \\
A_{n1} & A_{n2} & \dots & A_{nn}
\end{bmatrix}
\begin{bmatrix}
Y_{1,t-1} \\
Y_{2,t-1} \\
\vdots \\
Y_{n,t-1}
\end{bmatrix} \\
&\quad +
\begin{bmatrix}
B_{11} & B_{12} & B_{13} \\
B_{21} & B_{22} & B_{23} \\
B_{31} & B_{32} & B_{33}
\end{bmatrix}
\begin{bmatrix}
X_{1,t-1} \\
X_{2,t-1} \\
X_{3,t-1}
\end{bmatrix} +
\begin{bmatrix}
\varepsilon_{1,t} \\
\varepsilon_{2,t} \\
\vdots \\
\varepsilon_{n,t}
\end{bmatrix}
\end{aligned}
\]

## Data - **Theory** - Model 

- VAR(1)

where:

- \( Y_{t} \) is a vector representing the returns of Rivian at time \( t \),
- \( X_{t-1} \) is a vector representing the lagged returns of the external regressors at time \( t-1 \),
- \( A \) is a coefficient matrix capturing the lagged effects of Rivian returns,
- \( B \) is a coefficient matrix capturing the effects of lagged external regressors, and
- \( \varepsilon_{t} \) is a vector of error terms at time \( t \).


## Data - Theory - **Model**

Finding optimal lags of our VAR model for Rivian returns.

```{r, echo=FALSE, include=FALSE}
opt_lags_Rivian <- cbind(Rivian_dta$returns, Gasoline_dta$returns, LitBat_dta$returns, Chargepoint_dta$returns)
colnames(opt_lags_Rivian) <- cbind("Rivian", "Gas", "Lithium_batteries", "Chargepoint")

lagselect_rivian <- VARselect(opt_lags_Rivian, lag.max = 10, type = 'const')
xtable(as.data.frame(lagselect_rivian))
```

\begin{table}[ht]
\centering
\begin{tabular}{rrrrrrrrrrrr}
  \hline
 & selection & criteria.1 & criteria.2 & criteria.3 & criteria.4 ... \\
  \hline
AIC(n) &   1 & 8.29 & 8.31 & 8.33 & 8.37 ... \\
  HQ(n) &   1 & 8.35 & 8.42 & 8.49 & 8.57 ... \\
  SC(n) &   1 & 8.44 & 8.59 & 8.73 & 8.89 ... \\
  FPE(n) &   1 & 3982.78 & 4068.04 & 4151.32 & 4303.34... \\
   \hline
\end{tabular}
\caption{Table depicting the optimal number of lags to use in our VAR model for Rivian returns}
\end{table}

## Data - Theory - **Model**

Finding optimal lags of our VAR model for Tesla returns.

```{r, echo=FALSE, include=FALSE}
opt_lags_Tesla <- cbind(Tesla_dta$returns, Gasoline_dta$returns, LitBat_dta$returns, Chargepoint_dta$returns)
colnames(opt_lags_Tesla) <- cbind("Tesla", "Gas", "Lithium_batteries", "Chargepoint")

lagselect_Tesla <- VARselect(opt_lags_Tesla, lag.max = 10, type = 'const')
xtable(as.data.frame(lagselect_Tesla))
```

\begin{table}[ht]
\centering
\begin{tabular}{rrrrrrrrrrrr}
  \hline
 & selection & criteria.1 & criteria.2 & criteria.3 & criteria.4 ... \\ 
  \hline
AIC(n) &   1 & 7.65 & 7.67 & 7.69 & 7.71 ... \\ 
  HQ(n) &   1 & 7.71 & 7.78 & 7.85 & 7.91 ... \\ 
  SC(n) &   1 & 7.80 & 7.94 & 8.09 & 8.23 ... \\ 
  FPE(n) &   1 & 2092.56 & 2139.35 & 2196.39 & 2220.36 ... \\ 
   \hline
\end{tabular}
\caption{Table depicting the optimal number of lags to use in our VAR model for Tesla returns}
\end{table}

## Data - Theory - **Model**

Inspecting the Granger Causality of our Rivian VAR model.

```{r, echo=FALSE, include=FALSE}
# Granger Causality

Granger_Rivian <- causality(VAR_model_Rivian, cause = "Rivian")
Granger_Rivian

Granger_Gas <- causality(VAR_model_Rivian, cause = "Gas")
Granger_Gas

Granger_LitBat <- causality(VAR_model_Rivian, cause = "Lithium_batteries")
Granger_LitBat

Granger_Chargepoint <- causality(VAR_model_Rivian, cause = "Chargepoint")
Granger_Chargepoint
```

\begin{table}[h]
\centering
\begin{tabular}{lcccc}
\hline
Granger Causality Test & F-Test & p-value \\
\hline
Rivian does not cause Gas & 1.5337 & 0.2038 \\
Gas does not cause Rivian & 1.8225 & 0.1409 \\
LitBat does not cause Rivian & 0.90716 & 0.4368 \\
CP does not cause Rivian  & 0.039752 & 0.9894 \\
\hline
\end{tabular}
\caption{Granger Causality Test Results for Rivian returns}
\label{tab:granger_rivian}
\end{table}


## Data - Theory - **Model**

Inspecting the Granger Causality of our Tesla VAR model.

```{r, echo=FALSE, include=FALSE}
# Granger Causality

Granger_Tesla <- causality(VAR_model_Tesla, cause = "Tesla")
Granger_Tesla

Granger_Gas <- causality(VAR_model_Tesla, cause = "Gas")
Granger_Gas

Granger_LitBat <- causality(VAR_model_Tesla, cause = "Lithium_batteries")
Granger_LitBat

Granger_Chargepoint <- causality(VAR_model_Tesla, cause = "Chargepoint")
Granger_Chargepoint
```


\begin{table}[h]
\centering
\begin{tabular}{lcccc}
\hline
Granger Causality Test & F-Test &  p-value \\
\hline
Tesla does not cause Gas & 0.86932 &  0.4563 \\
Gas does not cause Tesla & 2.0865 &  0.09996 \\
LitBat does not cause Tesla & 1.8949 &  0.1283 \\
CP does not cause Tesla  & 1.5879 &  0.1903 \\
\hline
\end{tabular}
\caption{Granger Causality Test Results for Tesla returns}
\label{tab:granger_tesla}
\end{table}


## Data - Theory - **Model**

\begin{table}[!ht]
    \centering
    \begin{tabular}{lll}
    \hline
        Model & AIC & BIC \\ \hline
        ARMA(0,0) GARCH(1,1) & 6.1424 & 6.1808* \\
        ARMA(1,0) GARCH(1,1) & 6.1454 & 6.1916 \\
        ARMA(0,1) GARCH(1,1) & 6.1455 & 6.1916 \\
        ARMA(1,1) GARCH(1,1) & 6.1471 & 6.2009 \\
        ARMA(0,0) GARCH(2,1) & 6.1422* & 6.1883 \\
        ARMA(1,0) GARCH(2,1) & 6.1453 & 6.1991 \\
        ARMA(0,1) GARCH(2,1) & 6.1453 & 6.1991 \\
        ARMA(1,1) GARCH(2,1) & 6.1473 & 6.2088 \\
        ARMA(0,0) GARCH(2,2) & 6.1829 & 6.2367 \\
        \hline
    \end{tabular}
    \caption{AIC and BIC of different GARCH models of Rivian returns}
\end{table}

## Data - Theory - **Model**

\begin{table}[!ht]
    \centering
    \begin{tabular}{lll}
    \hline
        Model & AIC & BIC \\ \hline
        ARMA(0,0) GARCH(1,1) & 5.4993 & 5.5381 \\ 
        ARMA(1,0) GARCH(1,1) & 5.5028 & 5.5493 \\ 
        ARMA(0,1) GARCH(1,1) & 5.5028 & 5.5493 \\ 
        ARMA(1,1) GARCH(1,1) & 5.5025 & 5.5568 \\ 
        ARMA(0,0) GARCH(2,1) & 5.4951 & 5.5416 \\ 
        ARMA(1,0) GARCH(2,1) & 5.4986 & 5.5528 \\ 
        ARMA(0,1) GARCH(2,1) & 5.4986 & 5.5528 \\ 
        ARMA(1,1) GARCH(2,1) & 5.4985 & 5.5605 \\ 
        ARMA(0,0) GARCH(2,2) & 5.4903* & 5.5446* \\ 
    \hline
    \end{tabular}
    \caption{AIC and BIC of different GARCH models of Tesla returns}
\end{table}

## Data - Theory - **Model**

Due to the AIC and BIC of all models being not significantly different from one another I will choose to use the ARMA(0,0) GARCH(1,1) to use the best most simple model with the least extra variables in the model for both the Rivian returns and for the Tesla Returns.


## Data Analysis

```{r, include = FALSE}
Rivian_dta_now <- tq_get("RIVN", get = "stock.prices", from = "2024-03-21", to = "2024-04-02")
Tesla_dta_now <- tq_get("TSLA", get = "stock.prices", from = "2024-03-21", to = "2024-04-02")
```

```{r}
clean_now_rivian <- data_cleaning(Rivian_dta_now)
clean_now_tesla <- data_cleaning(Tesla_dta_now)
```

```{r}
Rivian_forecast_dta <- as.data.frame(Rivian_forcast$fcst)
Tesla_forecast_dta <- as.data.frame(Tesla_forecast$fcst)
```



VAR Forecasts

```{r, warning=FALSE, echo=FALSE, fig.width=6, fig.height=3, fig.cap="Forecast of Rivian returns with our VAR(1) model", message=FALSE}

# Convert dates to proper format if needed
Rivian_dta$date <- as.Date(Rivian_dta$date)

# Create date sequence for the forecast period
last_date <- tail(Rivian_dta$date, 1)
forecast_dates <- seq(last_date + 1, by = "day", length.out = 6)

# Filter data for dates from January 1st, 2024, onward
Rivian_dta_filtered <- Rivian_dta[Rivian_dta$date >= as.Date("2024-01-01"), ]

# Define the date range to highlight
highlight_dates <- data.frame(start = as.Date("2024-02-19"), end = as.Date("2024-02-26"))

# Plot returns over time
ggplot() +
  geom_line(data = Rivian_dta_filtered, aes(x = date, y = returns), color = "black", size = 0.5) +
  # Add forecasted values and confidence intervals
  geom_line(data = Rivian_forecast_dta, aes(x = forecast_dates, y = Rivian.fcst), color = "blue", linetype = "dashed", size = 0.5) +
  geom_ribbon(data = Rivian_forecast_dta, aes(x = forecast_dates, ymin = Rivian.lower, ymax = Rivian.upper), fill = "red", alpha = 0.3) +
  # Highlight the specified date range
  geom_rect(data = highlight_dates, aes(xmin = start, xmax = end, ymin = -Inf, ymax = Inf), fill = "orange", alpha = 0.3) +
  # Customize the plot
  labs(title = "Forecast of Rivian returns",
       x = "Date",
       y = "Rivian Returns") +
  theme(legend.position="right") +
  theme_minimal()


```

## Data Analysis

The period from February 19 to February 26 in Rivian's returns stands out due to a significant decline of approximately 30%. A closer examination on the news during that week revealed that this decline resulted from disappointing 2024 deliveries and earnings reported on February 23. It appears that market expectations were not met, leading to the observed decrease in returns. However, the subsequent rebound in returns might suggest that the initial sell-off reaction was perhaps exaggerated.

## Data Analysis

```{r, warning=FALSE, echo=FALSE, fig.width=6, fig.height=3, fig.cap="Forecast of Tesla returns with our VAR(1) model", message=FALSE}
# Convert dates to proper format if needed
Tesla_dta$date <- as.Date(Tesla_dta$date)

# Create date sequence for the forecast period
last_date <- tail(Tesla_dta$date, 1)
forecast_dates <- seq(last_date + 1, by = "day", length.out = 6)

# Filter data for dates from January 1st, 2024, onward
Tesla_dta_filtered <- Tesla_dta[Tesla_dta$date >= as.Date("2024-01-01"), ]

# Define the date range to highlight
highlight_dates_tesla <- data.frame(start = as.Date("2024-01-22"), end = as.Date("2024-01-28"))

# Plot returns over time
ggplot() +
  geom_line(data = Tesla_dta_filtered, aes(x = date, y = returns), color = "black", size = 0.5) +
  # Add forecasted values and confidence intervals
  geom_line(data = Tesla_forecast_dta, aes(x = forecast_dates, y = Tesla.fcst), color = "blue", linetype = "dashed", size = 0.5) +
  geom_ribbon(data = Tesla_forecast_dta, aes(x = forecast_dates, ymin = Tesla.lower, ymax = Tesla.upper), fill = "red", alpha = 0.3) +
  # Highlight the specified date range
  geom_rect(data = highlight_dates_tesla, aes(xmin = start, xmax = end, ymin = -Inf, ymax = Inf), fill = "orange", alpha = 0.3) +
  # Customize the plot
  labs(title = "Forecast of Tesla returns",
       x = "Date",
       y = "Tesla Returns") +
  theme(legend.position="right") +
  theme_minimal()

```

## Data Analysis

The period from 2024-01-22 to 2024-01-28 is highlighted in Tesla's returns due to a decline of approximately 12%. After reviewing the news of Tesla's returns on January 25th 2024 I realized the reason for the decrease in the returns was a due to the company reporting earnings that missed expectations with warnings of a slowdown in 2024. Again I believe the subsequent rebound in returns might suggest that the initial sell-off reaction was perhaps exaggerated.


## Data Analysis

```{r, include=FALSE}
# Obtain forecasted values
Rivian_forecast_num <- Rivian_forcast$fcst$Rivian
Tesla_forecast_num <- Tesla_forecast$fcst$Tesla

error_riv <- abs(clean_now_rivian$returns - Rivian_forecast_num)
error_tesla <- abs(clean_now_tesla$returns - Tesla_forecast_num)

# Calculate absolute percentage error
Rivian_absolute_error <- error_riv[1:6] / abs(clean_now_rivian$returns) * 100
Tesla_absolute_error <- error_tesla[1:6] / abs(clean_now_tesla$returns) * 100

# Calculate MAPE
Rivian_MAPE <- mean(Rivian_absolute_error, na.rm = TRUE)
Tesla_MAPE <- mean(Tesla_absolute_error, na.rm = TRUE)

# Print MAPE
cat("MAPE for Rivian:", Rivian_MAPE, "\n")
cat("MAPE for Tesla:", Tesla_MAPE, "\n")

```


```{r, include=FALSE}
# Fit the chosen GARCH model
mod_spec_garch_best <- ugarchspec(
  mean.model = list(armaOrder = c(0, 0)),
  variance.model = list(model = "sGARCH", garchOrder = c(1, 1))
)

mod_fitting_garch_best <- ugarchfit(data = Rivian_dta$returns, spec = mod_spec_garch_best, out.sample = 20)

# Forecast future volatility
forecast_garch <- ugarchforecast(mod_fitting_garch_best, n.ahead = 6)
print(forecast_garch)

# Plot the forecasted volatility
#plot(forecast_garch)
```



```{r, include=FALSE}
# Fit the chosen GARCH model
mod_spec_garch_best_Tesla <- ugarchspec(
  mean.model = list(armaOrder = c(0, 0)),
  variance.model = list(model = "sGARCH", garchOrder = c(2, 2))
)

mod_fitting_garch_best_Tesla <- ugarchfit(data = Tesla_dta$returns, spec = mod_spec_garch_best_Tesla, out.sample = 20)

# Forecast future volatility
forecast_garch_Tesla <- ugarchforecast(mod_fitting_garch_best_Tesla, n.ahead = 6)
print(forecast_garch_Tesla)

# Plot the forecasted volatility
#plot(forecast_garch_Tesla)

```


```{r,include=FALSE}
# Obtain forecasted volatility for Rivian
forecast_volatility_rivian <- forecast_garch@forecast$sigmaFor

# Calculate realized volatility for Rivian
realized_volatility_rivian <- sd(clean_now_rivian$returns)

# Calculate absolute percentage error for Rivian
absolute_error_rivian <- abs((realized_volatility_rivian - forecast_volatility_rivian) / realized_volatility_rivian) * 100

# Calculate MAPE for Rivian
MAPE_rivian <- mean(absolute_error_rivian, na.rm = TRUE)

# Obtain forecasted volatility for Tesla
forecast_volatility_tesla <- forecast_garch@forecast$sigmaFor

# Calculate realized volatility for Tesla
realized_volatility_tesla <- sd(clean_now_tesla$returns)

# Calculate absolute percentage error for Tesla
absolute_error_tesla <- abs((realized_volatility_tesla - forecast_volatility_tesla) / realized_volatility_tesla) * 100

# Calculate MAPE for Tesla
MAPE_tesla <- mean(absolute_error_tesla, na.rm = TRUE)

# Print MAPE for both Rivian and Tesla
cat("MAPE for Rivian:", MAPE_rivian, "\n")
cat("MAPE for Tesla:", MAPE_tesla, "\n")

```

\begin{table}[!ht]
    \centering
    \begin{tabular}{lrr}
    \hline
    & Rivian & Tesla \\ 
    \hline
    Forecasted Returns MAPE & 79.7571 & 95.56485 \\
    Forecasted Volatility MAPE & 84.73849 & 166.2075 \\ 
    \hline
    \end{tabular}
    \caption{MAPE values for forecasts of returns and volatility for Rivian and Tesla}
    \label{theone}
\end{table}


## **Conclusion** - Future Research

Upon reviewing the results presented in Table 9, it becomes evident that both the VAR and GARCH models exhibit noticeably high MAPE (Mean Absolute Percentage Error) values. This suggests that the forecasts generated by these models may lack accuracy. Furthermore, the observed high MAPE values indicate a potential lack of explanatory power in the returns of Gasoline, Lithium Battery, and EV Charger producer stocks. While the MAPE for the forecast of Rivian appears to be relatively decent, further research is warranted to ascertain whether this performance holds consistently over the entire lifetime of the stock. Additionally, it's crucial to investigate whether this outcome is an isolated occurrence, given that the stock exhibited lower volatility during the forecast period compared to historical data.

## Conclusion - **Future Research**

- Future research endeavors should aim to develop a VAR-GARCH model capable of leveraging stock volatility data to enhance the accuracy of return forecasts.
- Additionally, there is a need to refine the forecasting horizon to shorter periods, such as 1 or 2 days, and evaluate the model's performance on a day-to-day basis to assess its precision with a more focused forecast.
- Exploring the potential explanatory power of the number of active EV car chargers in a region could be a valuable avenue for investigation. This aspect, not fully captured by stock returns alone, suggests the potential benefits of integrating geospatial data into the modeling framework. By incorporating real-time data on active EV chargers, it may be possible to better predict future returns, considering the influence of infrastructure development on consumer behavior towards electric vehicles.

## Conclusion - **Future Research**

- Exploring the impact of the implementation of the Federal carbon tax on the returns of an EV startup stock is of particular interest. Although my analysis was constrained by the IPO timing of Rivian, focusing solely on stocks that debuted before the introduction of the Federal carbon tax would allow for a clearer examination of the policy's influence on EV stock returns.
- Additionally, investigating the effects of the Federal rebate for EV cars presents another intriguing avenue for research. Given that this incentive encourages Canadians to purchase EVs, it is reasonable to anticipate a positive impact on the returns of relevant stocks. Exploring this relationship further could provide valuable insights into the dynamics between government policies and EV market performance.


## Questions

## References {.allowframebreaks} 

<div id="refs"></div>



